window.CustomModernizr=function(e,t,i){function n(e){m.cssText=e}function s(e,t){return typeof e===t}function r(e,t){return!!~(""+e).indexOf(t)}function o(e,t){for(var n in e){var s=e[n];if(!r(s,"-")&&m[s]!==i)return"pfx"!=t||s}return!1}function a(e,t,n){for(var r in e){var o=t[e[r]];if(o!==i)return!1===n?e[r]:s(o,"function")?o.bind(n||t):o}return!1}function l(e,t,i){var n=e.charAt(0).toUpperCase()+e.slice(1),r=(e+" "+y.join(n+" ")+n).split(" ");return s(t,"string")||s(t,"undefined")?o(r,t):(r=(e+" "+w.join(n+" ")+n).split(" "),a(r,t,i))}var d,f,h={},p=t.documentElement,c="modernizr",u=t.createElement(c),m=u.style,g=" -webkit- -moz- -o- -ms- ".split(" "),v="Webkit Moz O ms",y=v.split(" "),w=v.toLowerCase().split(" "),x={},_=[],I=_.slice,b=function(e,i,n,s){var r,o,a,l,d=t.createElement("div"),f=t.body,h=f||t.createElement("body");if(parseInt(n,10))for(;n--;)a=t.createElement("div"),a.id=s?s[n]:c+(n+1),d.appendChild(a);return r=["&#173;",'<style id="s',c,'">',e,"</style>"].join(""),d.id=c,(f?d:h).innerHTML+=r,h.appendChild(d),f||(h.style.background="",h.style.overflow="hidden",l=p.style.overflow,p.style.overflow="hidden",p.appendChild(h)),o=i(d,e),f?d.parentNode.removeChild(d):(h.parentNode.removeChild(h),p.style.overflow=l),!!o},C={}.hasOwnProperty;f=s(C,"undefined")||s(C.call,"undefined")?function(e,t){return t in e&&s(e.constructor.prototype[t],"undefined")}:function(e,t){return C.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var i=I.call(arguments,1),n=function(){if(this instanceof n){var s=function(){};s.prototype=t.prototype;var r=new s,o=t.apply(r,i.concat(I.call(arguments)));return Object(o)===o?o:r}return t.apply(e,i.concat(I.call(arguments)))};return n}),x.csstransforms=function(){return!!l("transform")},x.csstransforms3d=function(){var e=!!l("perspective");return e&&"webkitPerspective"in p.style&&b("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(t,i){e=9===t.offsetLeft&&3===t.offsetHeight}),e},x.csstransitions=function(){return l("transition")};for(var T in x)f(x,T)&&(d=T.toLowerCase(),h[d]=x[T](),_.push((h[d]?"":"no-")+d));return h.addTest=function(e,t){if("object"==typeof e)for(var n in e)f(e,n)&&h.addTest(n,e[n]);else{if(e=e.toLowerCase(),h[e]!==i)return h;t="function"==typeof t?t():t,p.className+=" "+(t?"":"no-")+e,h[e]=t}return h},n(""),u=null,h._version="2.6.2",h._prefixes=g,h._domPrefixes=w,h._cssomPrefixes=y,h.testProp=function(e){return o([e])},h.testAllProps=l,h.testStyles=b,h.prefixed=function(e,t,i){return t?l(e,t,i):l(e,"pfx")},p.className=p.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+" js "+_.join(" "),h}(0,this.document),window.findAndReplaceDOMText=function(){function e(e){return String(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function t(){return i.apply(null,arguments)||n.apply(null,arguments)}function i(e,i,s,r,o){if(i&&!i.nodeType&&arguments.length<=2)return!1;var a="function"==typeof s;a&&(s=function(e){return function(t,i){return e(t.text,i.startIndex)}}(s));var l=n(i,{find:e,wrap:a?null:s,replace:a?s:"$"+(r||"&"),prepMatch:function(e,t){if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(r>0){var i=e[r];e.index+=e[0].indexOf(i),e[0]=i}return e.endIndex=e.index+e[0].length,e.startIndex=e.index,e.index=t,e},filterElements:o});return t.revert=function(){return l.revert()},!0}function n(e,t){return new s(e,t)}function s(e,t){t.portionMode=t.portionMode||r,this.node=e,this.options=t,this.prepMatch=t.prepMatch||this.prepMatch,this.reverts=[],this.matches=this.search(),this.matches.length&&this.processMatches()}var r="retain",o=document;return t.Finder=s,s.prototype={search:function(){var t,i=0,n=this.options.find,s=this.getAggregateText(),r=[];if((n="string"==typeof n?RegExp(e(n),"g"):n).global)for(;t=n.exec(s);)r.push(this.prepMatch(t,i++));else(t=s.match(n))&&r.push(this.prepMatch(t,0));return r},prepMatch:function(e,t){if(!e[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");return e.endIndex=e.index+e[0].length,e.startIndex=e.index,e.index=t,e},getAggregateText:function(){function e(i){if(3===i.nodeType)return i.data;if(t&&!t(i))return"";var n="";if(i=i.firstChild)do{n+=e(i)}while(i=i.nextSibling);return n}var t=this.options.filterElements;return e(this.node)},processMatches:function(){var e,t,i,n=this.matches,s=this.node,r=this.options.filterElements,o=[],a=s,l=n.shift(),d=0,f=0,h=0,p=[s];e:for(;;){if(3===a.nodeType&&(!t&&a.length+d>=l.endIndex?t={node:a,index:h++,text:a.data.substring(l.startIndex-d,l.endIndex-d),indexInMatch:d-l.startIndex,indexInNode:l.startIndex-d,endIndexInNode:l.endIndex-d,isEnd:!0}:e&&o.push({node:a,index:h++,text:a.data,indexInMatch:d-l.startIndex,indexInNode:0}),!e&&a.length+d>l.startIndex&&(e={node:a,index:h++,indexInMatch:0,indexInNode:l.startIndex-d,endIndexInNode:l.endIndex-d,text:a.data.substring(l.startIndex-d,l.endIndex-d)}),d+=a.data.length),i=1===a.nodeType&&r&&!r(a),e&&t){if(a=this.replaceMatch(l,e,o,t),d-=t.node.data.length-t.endIndexInNode,e=null,t=null,o=[],l=n.shift(),h=0,f++,!l)break}else if(!i&&(a.firstChild||a.nextSibling)){a.firstChild?(p.push(a),a=a.firstChild):a=a.nextSibling;continue}for(;;){if(a.nextSibling){a=a.nextSibling;break}if((a=p.pop())===s)break e}}},revert:function(){for(var e=this.reverts.length;e--;)this.reverts[e]();this.reverts=[]},prepareReplacementString:function(e,t,i,n){var s=this.options.portionMode;return"first"===s&&t.indexInMatch>0?"":(e=e.replace(/\$(\d+|&|`|')/g,function(e,t){var n;switch(t){case"&":n=i[0];break;case"`":n=i.input.substring(0,i.startIndex);break;case"'":n=i.input.substring(i.endIndex);break;default:n=i[+t]}return n}),"first"===s?e:t.isEnd?e.substring(t.indexInMatch):e.substring(t.indexInMatch,t.indexInMatch+t.text.length))},getPortionReplacementNode:function(e,t,i){var n=this.options.replace||"$&",s=this.options.clss,r=this.options.wrap;if(r&&r.nodeType){var a=o.createElement("div");a.innerHTML=r.outerHTML||(new XMLSerializer).serializeToString(r),r=a.firstChild}if("function"==typeof n)return n=n(e,t,i),n&&n.nodeType?n:o.createTextNode(String(n));var l="string"==typeof r?o.createElement(r):r;return s&&(l.className=s),(n=o.createTextNode(this.prepareReplacementString(n,e,t,i))).data&&l?(l.appendChild(n),l):n},replaceMatch:function(e,t,i,n){var s,r,a=t.node,l=n.node;if(a===l){var d=a;t.indexInNode>0&&(s=o.createTextNode(d.data.substring(0,t.indexInNode)),d.parentNode.insertBefore(s,d));var f=this.getPortionReplacementNode(n,e);return d.parentNode.insertBefore(f,d),n.endIndexInNode<d.length&&(r=o.createTextNode(d.data.substring(n.endIndexInNode)),d.parentNode.insertBefore(r,d)),d.parentNode.removeChild(d),this.reverts.push(function(){s===f.previousSibling&&s.parentNode.removeChild(s),r===f.nextSibling&&r.parentNode.removeChild(r),f.parentNode.replaceChild(d,f)}),f}s=o.createTextNode(a.data.substring(0,t.indexInNode)),r=o.createTextNode(l.data.substring(n.endIndexInNode));for(var h=this.getPortionReplacementNode(t,e),p=[],c=0,u=i.length;c<u;++c){var m=i[c],g=this.getPortionReplacementNode(m,e);m.node.parentNode.replaceChild(g,m.node),this.reverts.push(function(e,t){return function(){t.parentNode.replaceChild(e.node,t)}}(m,g)),p.push(g)}var v=this.getPortionReplacementNode(n,e);return a.parentNode.insertBefore(s,a),a.parentNode.insertBefore(h,a),a.parentNode.removeChild(a),l.parentNode.insertBefore(v,l),l.parentNode.insertBefore(r,l),l.parentNode.removeChild(l),this.reverts.push(function(){s.parentNode.removeChild(s),h.parentNode.replaceChild(a,h),r.parentNode.removeChild(r),v.parentNode.replaceChild(l,v)}),v}},t}(),function(e){function t(t,r){if(this.element=t,this.options=e.extend({},n,r),e(this.element).data("max-height",this.options.maxHeight),e(this.element).data("height-margin",this.options.heightMargin),delete this.options.maxHeight,this.options.embedCSS&&!s){var o=".readmore-js-toggle, .readmore-js-section { "+this.options.sectionCSS+" } .readmore-js-section { overflow: hidden; }";!function(e,t){var i=e.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(e.createTextNode(t)),e.getElementsByTagName("head")[0].appendChild(i)}(document,o),s=!0}this._defaults=n,this._name=i,this.init()}var i="readmore",n={speed:100,maxHeight:200,heightMargin:16,moreLink:'<a href="#">'+window.FlowFlowOpts.expand_text+"</a>",lessLink:'<a href="#">'+window.FlowFlowOpts.collapse_text+"</a>",embedCSS:!0,sectionCSS:"display: block; width: 100%;",startOpen:!1,expandedClass:"readmore-js-expanded",collapsedClass:"readmore-js-collapsed",beforeToggle:function(){},afterToggle:function(){}},s=!1;t.prototype={init:function(){var t=this;e(this.element).each(function(){var i=e(this),n=i.css("max-height"),s=n.replace(/[^-\d\.]/g,"")>i.data("max-height")?n.replace(/[^-\d\.]/g,""):i.data("max-height"),r=i.data("height-margin");if("none"!=n&&i.css("max-height","none"),t.setBoxHeight(i),i.outerHeight(!0)<=s+r)return!0;i.addClass("readmore-js-section "+t.options.collapsedClass).data("collapsedHeight",s);var o=t.options.startOpen?t.options.lessLink:t.options.moreLink;i.after(e(o).on("click",function(e){t.toggleSlider(this,i,e)}).addClass("readmore-js-toggle")),t.options.startOpen||i.css({height:s})})},toggleSlider:function(t,i,n){n.preventDefault();var s=this,r=newLink=sectionClass="",o=!1,a=e(i).data("collapsedHeight");e(i).height()<=a?(r=e(i).data("expandedHeight")+"px",newLink="lessLink",o=!0,sectionClass=s.options.expandedClass):(r=a,newLink="moreLink",sectionClass=s.options.collapsedClass),s.options.beforeToggle(t,i,o),e(i).animate({height:r},{duration:s.options.speed,complete:function(){s.options.afterToggle(t,i,o),e(t).replaceWith(e(s.options[newLink]).on("click",function(e){s.toggleSlider(this,i,e)}).addClass("readmore-js-toggle")),e(this).removeClass(s.options.collapsedClass+" "+s.options.expandedClass).addClass(sectionClass)}})},setBoxHeight:function(e){var t=e.clone().css({height:"auto",width:e.width(),overflow:"hidden"}).insertAfter(e),i=t.outerHeight(!0);t.remove(),e.data("expandedHeight",i)},resizeBoxes:function(){var t=this;e(".readmore-js-section").each(function(){var i=e(this);t.setBoxHeight(i),(i.height()>i.data("expandedHeight")||i.hasClass(t.options.expandedClass)&&i.height()<i.data("expandedHeight"))&&i.css("height",i.data("expandedHeight"))})},destroy:function(){var t=this;e(this.element).each(function(){var i=e(this);i.removeClass("readmore-js-section "+t.options.collapsedClass+" "+t.options.expandedClass).css({"max-height":"",height:"auto"}).next(".readmore-js-toggle").remove(),i.removeData()})}},e.fn[i]=function(n){var s=arguments;return void 0===n||"object"==typeof n?this.each(function(){if(e.data(this,"plugin_"+i)){var s=e.data(this,"plugin_"+i);s.destroy.apply(s)}e.data(this,"plugin_"+i,new t(this,n))}):"string"==typeof n&&"_"!==n[0]&&"init"!==n?this.each(function(){var r=e.data(this,"plugin_"+i);r instanceof t&&"function"==typeof r[n]&&r[n].apply(r,Array.prototype.slice.call(s,1))}):void 0}}(jQuery),function(e){window.Shuffle=e(window.jQuery,window.CustomModernizr)}(function(e,t,i){"use strict";function n(e,t,i){for(var n=0,s=e.length;n<s;n++)if(t.call(i,e[n],n,e)==={})return}function s(t,i,n){return setTimeout(e.proxy(t,i),n)}function r(e){return Math.max.apply(Math,e)}function o(e){return Math.min.apply(Math,e)}function a(t){return e.isNumeric(t)?t:0}function l(e){var t,i,n=e.length;if(!n)return e;for(;--n;)t=e[i=Math.floor(Math.random()*(n+1))],e[i]=e[n],e[n]=t;return e}if("object"!=typeof t)throw new Error("Shuffle.js requires Modernizr.\nhttp://vestride.github.io/Shuffle/#dependencies");var d=t.prefixed("transition"),f=t.prefixed("transitionDelay"),h=t.prefixed("transitionDuration"),p={WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[d],c=t.prefixed("transform"),u=function(e){return e?e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()}).replace(/^ms-/,"-ms-"):""}(c),m=t.csstransforms&&t.csstransitions,g=t.csstransforms3d,v=function(e,t){this.x=a(e),this.y=a(t)};v.equals=function(e,t){return e.x===t.x&&e.y===t.y};var y=0,w=e(window),x=0,_=function(t,i){i=i||{},e.extend(this,_.options,i,_.settings),this.$el=e(t),this.id=x++,this.element=t,this.unique="shuffle_"+y++,this._fire(_.EventType.LOADING),this._init(),s(function(){this.initialized=!0,this._fire(_.EventType.DONE)},this,16)};return _.EventType={LOADING:"loading",DONE:"done",LAYOUT:"layout",REMOVED:"removed"},_.ClassName={BASE:"shuffle",SHUFFLE_ITEM:"shuffle-item",FILTERED:"filtered",CONCEALED:"concealed"},_.options={group:"all",speed:250,easing:"ease-out",itemSelector:"",sizer:null,gutterWidth:0,columnWidth:0,delimeter:null,buffer:0,initialSort:null,throttle:function(t,i,n){var s,r,o,a=null,l=0;n=n||{};var d=function(){l=!1===n.leading?0:e.now(),a=null,o=t.apply(s,r),s=r=null};return function(){var f=e.now();l||!1!==n.leading||(l=f);var h=i-(f-l);return s=this,r=arguments,h<=0||h>i?(clearTimeout(a),a=null,l=f,o=t.apply(s,r),s=r=null):a||!1===n.trailing||(a=setTimeout(d,h)),o}},throttleTime:300,sequentialFadeDelay:150,supported:m},_.settings={useSizer:!1,itemCss:{position:"absolute",top:0,left:0,visibility:"visible"},revealAppendedDelay:300,lastSort:{},lastFilter:"all",enabled:!0,destroyed:!1,initialized:!1,_animations:[],styleQueue:[]},_.Point=v,_._getItemTransformString=function(e,t){return g?"translate3d("+e.x+"px, "+e.y+"px, 0) scale3d("+t+", "+t+", 1)":"translate("+e.x+"px, "+e.y+"px) scale("+t+")"},_._getNumberStyle=function(t,i){return _._getFloat(e(t).css(i))},_._getInt=function(e){return a(parseInt(e,10))},_._getFloat=function(e){return a(parseFloat(e))},_._getOuterWidth=function(t,i){return e(t).outerWidth(!!i)},_._getOuterHeight=function(t,i){return e(t).outerHeight(!!i)},_._skipTransition=function(e,t,i){var n=e.style[h];e.style[h]="0ms",t.call(i);e.offsetWidth;e.style[h]=n},_.prototype._init=function(){this.$items=this._getItems(),this.sizer=this._getElementOption(this.sizer),this.sizer&&(this.useSizer=!0),this.$el.addClass(_.ClassName.BASE),this._initItems(),w.on("resize.shuffle."+this.unique,this._getResizeFunction());var t=this.$el.css(["position","overflow"]),i=_._getOuterWidth(this.element);this._validateStyles(t),this._setColumns(i),this._itemMargin=parseInt(e(this.sizer).css("marginLeft")||0),this.shuffle(this.group,this.initialSort),this.supported&&s(function(){this.destroyed||(this._setTransitions(),this.element.style[d]="height "+this.speed+"ms "+this.easing)},this)},_.prototype._getResizeFunction=function(){var t=e.proxy(this._onResize,this);return this.throttle?this.throttle(t,this.throttleTime):t},_.prototype._getElementOption=function(e){return"string"==typeof e?this.$el.find(e)[0]||null:e&&e.nodeType&&1===e.nodeType?e:e&&e.jquery?e[0]:null},_.prototype._validateStyles=function(e){"static"===e.position&&(this.element.style.position="relative"),e.overflow},_.prototype._filter=function(e,t){e=e||this.lastFilter,t=t||this.$items;var i=this._getFilteredSets(e,t);return this._toggleFilterClasses(i.filtered,i.concealed),this.lastFilter=e,"string"==typeof e&&(this.group=e),i.filtered},_.prototype._getFilteredSets=function(t,i){var s=e(),r=e();return"all"===t?s=i:n(i,function(i){var n=e(i);this._doesPassFilter(t,n)?s=s.add(n):r=r.add(n)},this),{filtered:s,concealed:r}},_.prototype._doesPassFilter=function(t,i){if(e.isFunction(t))return t.call(i[0],i,this);var n=i.data("groups"),s=this.delimeter&&!e.isArray(n)?n.split(this.delimeter):n;return e.inArray(t,s)>-1},_.prototype._toggleFilterClasses=function(e,t){e.removeClass(_.ClassName.CONCEALED).addClass(_.ClassName.FILTERED),t.removeClass(_.ClassName.FILTERED).addClass(_.ClassName.CONCEALED)},_.prototype._initItems=function(e){(e=e||this.$items).addClass([_.ClassName.SHUFFLE_ITEM,_.ClassName.FILTERED].join(" ")),e.css(this.itemCss).data("point",new v).data("scale",1)},_.prototype._updateItemCount=function(){this.visibleItems=this._getFilteredItems().length},_.prototype._setTransition=function(e){e.style[d]=u+" "+this.speed+"ms "+this.easing+", opacity "+this.speed+"ms "+this.easing},_.prototype._setTransitions=function(e){n(e=e||this.$items,function(e){this._setTransition(e)},this)},_.prototype._setSequentialDelay=function(e){this.supported&&n(e,function(e,t){e.style[f]="0ms,"+(t+1)*this.sequentialFadeDelay+"ms"},this)},_.prototype._getItems=function(){return this.$el.children(this.itemSelector)},_.prototype._getFilteredItems=function(){return this.destroyed?e():this.$items.filter("."+_.ClassName.FILTERED)},_.prototype._getConcealedItems=function(){return this.$items.filter("."+_.ClassName.CONCEALED)},_.prototype._getColumnSize=function(t,i){var n;return 0===(n=e.isFunction(this.columnWidth)?this.columnWidth(t):this.useSizer?_._getOuterWidth(this.sizer):this.columnWidth?this.columnWidth:this.$items.length>0?_._getOuterWidth(this.$items[0],!0):t)&&(n=t),n+i},_.prototype._getGutterSize=function(t){return e.isFunction(this.gutterWidth)?this.gutterWidth(t):this.useSizer?_._getNumberStyle(this.sizer,"marginLeft"):this.gutterWidth},_.prototype._setColumns=function(e){var t=e||_._getOuterWidth(this.element),i=this._getGutterSize(t),n=this._getColumnSize(t,i),s=(t+i)/n;this.cols=Math.max(Math.floor(s),1),this.containerWidth=t,this.colWidth=n},_.prototype._setContainerSize=function(){this.$el.css("height",this._getContainerSize())},_.prototype._getContainerSize=function(){return r(this.positions)},_.prototype._fire=function(e,t){this.$el.trigger(e+".shuffle",t&&t.length?t:[this])},_.prototype._resetCols=function(){var e=this.cols;for(this.positions=[];e--;)this.positions.push(0)},_.prototype._layout=function(e,t){n(e,function(e){this._layoutItem(e,!!t)},this),this._processStyleQueue(),this._setContainerSize()},_.prototype._layoutItem=function(t,i){var n=e(t),s=n.data(),r=(s.point,s.scale,{width:_._getOuterWidth(t,!0),height:_._getOuterHeight(t,!0)}),o=this._getItemPosition(r);s.point=o,s.scale=1,this.styleQueue.push({$item:n,point:o,scale:1,opacity:i?0:1,skipTransition:i,callfront:function(){i||n.css("visibility","visible")},callback:function(){i&&n.css("visibility","hidden")}})},_.prototype._getItemPosition=function(e){for(var t=this._getColumnSpan(e.width,this.colWidth,this.cols),i=this._getColumnSet(t,this.cols),n=this._getShortColumn(i,this.buffer),s=Math.round((this.containerWidth-(e.width*this.cols+this._itemMargin*(this.cols-1)))/2),r=new v(Math.round(this.colWidth*n+(s>0?s:0)),Math.round(i[n])),o=i[n]+e.height,a=this.cols+1-i.length,l=0;l<a;l++)this.positions[n+l]=o;return r},_.prototype._getColumnSpan=function(e,t,i){var n=e/t;return Math.abs(Math.round(n)-n)<.3&&(n=Math.round(n)),Math.min(Math.ceil(n),i)},_.prototype._getColumnSet=function(e,t){if(1===e)return this.positions;for(var i=t+1-e,n=[],s=0;s<i;s++)n[s]=r(this.positions.slice(s,s+e));return n},_.prototype._getShortColumn=function(e,t){for(var i=o(e),n=0,s=e.length;n<s;n++)if(e[n]>=i-t&&e[n]<=i+t)return n;return 0},_.prototype._shrink=function(t){n(t||this._getConcealedItems(),function(t){var i=e(t),n=i.data();.001!==n.scale&&(n.scale=.001,this.styleQueue.push({$item:i,point:n.point,scale:.001,opacity:0,callback:function(){i.css("visibility","hidden")}}))},this)},_.prototype._onResize=function(){!this.enabled||this.destroyed||this.isTransitioning||_._getOuterWidth(this.element)!==this.containerWidth&&this.update()},_.prototype._getStylesForTransition=function(e){var t={opacity:e.opacity};return this.supported?t[c]=_._getItemTransformString(e.point,e.scale):(t.left=e.point.x,t.top=e.point.y),t},_.prototype._transition=function(t){var i=this._getStylesForTransition(t);t.$item.data("keep-pos")?(t.$item.removeData("keep-pos"),s(function(){this._startItemAnimation(t.$item,i,t.callfront||e.noop,t.callback||e.noop)},this,1e3)):this._startItemAnimation(t.$item,i,t.callfront||e.noop,t.callback||e.noop)},_.prototype._startItemAnimation=function(t,i,n,s){function r(t){t.target===t.currentTarget&&(e(t.target).off(p,r),s())}if(n(),!this.initialized)return t.css(i),void s();if(this.supported)t.css(i),t.on(p,r);else{var o=t.stop(!0).animate(i,this.speed,"swing",s);this._animations.push(o.promise())}},_.prototype._processStyleQueue=function(t){var i=e();n(this.styleQueue,function(e){e.skipTransition?this._styleImmediately(e):(i=i.add(e.$item),this._transition(e))},this),i.length>0&&this.initialized?(this.isTransitioning=!0,this.supported?(this._whenCollectionDone(i,p,this._movementFinished),this.isTransitioning=!1):(this._whenAnimationsDone(this._movementFinished),this.isTransitioning=!1)):t||s(this._layoutEnd,this),this.styleQueue.length=0},_.prototype._styleImmediately=function(e){_._skipTransition(e.$item[0],function(){e.$item.css(this._getStylesForTransition(e))},this)},_.prototype._movementFinished=function(){this._layoutEnd()},_.prototype._layoutEnd=function(){this.destroyed||this._fire(_.EventType.LAYOUT)},_.prototype._addItems=function(e,t,i){this._initItems(e),this._setTransitions(e),this.$items=this._getItems(),this._shrink(e),n(this.styleQueue,function(e){e.skipTransition=!0}),this._processStyleQueue(!0),t?this._addItemsToEnd(e,i):this.shuffle(this.lastFilter)},_.prototype._addItemsToEnd=function(e,t){var i=this._filter(null,e).get();this._updateItemCount(),this._layout(i,!0),t&&this.supported&&this._setSequentialDelay(i),this._revealAppended(i)},_.prototype._revealAppended=function(t){s(function(){n(t,function(t){var i=e(t);this._transition({$item:i,opacity:1,point:i.data("point"),scale:1})},this),this._whenCollectionDone(e(t),p,function(){e(t).css(f,"0ms"),this._movementFinished()})},this,this.revealAppendedDelay)},_.prototype._whenCollectionDone=function(t,i,n){function s(t){t.target===t.currentTarget&&(e(t.target).off(i,s),++r===o&&n.call(a))}var r=0,o=t.length,a=this;t.on(i,s)},_.prototype._whenAnimationsDone=function(t){e.when.apply(null,this._animations).always(e.proxy(function(){this._animations.length=0,t.call(this)},this))},_.prototype.shuffle=function(e,t){this.enabled&&!this.isTransitioning&&(e||(e="all"),this._filter(e),this._updateItemCount(),this._shrink(),this.sort(t))},_.prototype.sort=function(e){if(this.enabled&&!this.isTransitioning){this._resetCols();var t=e||this.lastSort,i=this._getFilteredItems().sorted(t);this._layout(i),this.lastSort=t}},_.prototype.update=function(e){this.enabled&&!this.isTransitioning&&(e||this._setColumns(),this.sort())},_.prototype.layout=function(){this.destroyed||this.update(!0)},_.prototype.appended=function(e,t,i){this._addItems(e,!0,!0)},_.prototype.disable=function(){this.enabled=!1},_.prototype.enable=function(e){this.enabled=!0,!1!==e&&this.update()},_.prototype.remove=function(t){t.length&&t.jquery&&(this._toggleFilterClasses(e(),t),this._shrink(t),this.sort(),this.$el.one(_.EventType.LAYOUT+".shuffle",e.proxy(function(){t.remove(),this.$items=this._getItems(),this._updateItemCount(),this._fire(_.EventType.REMOVED,[t,this]),t=null},this)))},_.prototype.destroy=function(){w.off("."+this.unique),this.$el.removeClass("shuffle").removeAttr("style").removeData("shuffle"),this.$items.removeAttr("style").removeData("point").removeData("scale").removeClass([_.ClassName.CONCEALED,_.ClassName.FILTERED,_.ClassName.SHUFFLE_ITEM].join(" ")),this.$items=null,this.$el=null,this.sizer=null,this.element=null,this.destroyed=!0},e.fn.shuffle=function(t){var i=Array.prototype.slice.call(arguments,1);return this.each(function(){var n=e(this),s=n.data("shuffle");s?"string"==typeof t&&s[t]&&s[t].apply(s,i):(s=new _(this,t),n.data("shuffle",s))})},e.fn.sorted=function(t){var n=e.extend({},e.fn.sorted.defaults,t),s=this.get(),r=!1;return s.length?n.randomize?l(s):(e.isFunction(n.by)&&s.sort(function(t,s){if(r)return 0;var o=n.by(e(t)),a=n.by(e(s));return o===i&&a===i?(r=!0,0):o<a||"sortFirst"===o||"sortLast"===a?-1:o>a||"sortLast"===o||"sortFirst"===a?1:0}),r?this.get():(n.reverse&&s.reverse(),s)):[]},e.fn.sorted.defaults={reverse:!1,by:null,randomize:!1},_}),function(e,t){var i,n=e.jQuery||e.Cowboy||(e.Cowboy={});n.throttle=i=function(e,i,s,r){function o(){function n(){l=+new Date,s.apply(o,f)}var o=this,d=+new Date-l,f=arguments;r&&!a&&n(),a&&clearTimeout(a),r===t&&d>e?n():!0!==i&&(a=setTimeout(r?function(){a=t}:n,r===t?e-d:e))}var a,l=0;return"boolean"!=typeof i&&(r=s,s=i,i=t),n.guid&&(o.guid=s.guid=s.guid||n.guid++),o},n.debounce=function(e,n,s){return s===t?i(e,n,!1):i(e,s,!1!==n)}}(this),function(e){"use strict";var t=null,i=e(window),n=function(t){var i=this;if(e.extend(i,n.options,t,n.settings),!e.isFunction(i.enter))throw new TypeError("Viewport.add :: No `enter` function provided in Viewport options.");"string"==typeof i.threshold&&i.threshold.indexOf("%")>-1?(i.isThresholdPercentage=!0,i.threshold=parseFloat(i.threshold)/100):i.threshold<1&&i.threshold>0&&(i.isThresholdPercentage=!0),i.hasLeaveCallback=e.isFunction(i.leave),i.$element=e(i.element),i.update()};n.prototype.update=function(){var e=this;e.offset=e.$element.offset(),e.height=e.$element.height(),e.$element.data("height",e.height),e.width=e.$element.width(),e.$element.data("width",e.width)},n.options={threshold:200,delay:0},n.settings={triggered:!1,isThresholdPercentage:!1};var s=function(){this.init()};s.prototype={init:function(){var e=this;e.list=[],e.lastScrollY=0,e.windowHeight=i.height(),e.windowWidth=i.width(),e.throttleTime=100,e.onResize(),e.bindEvents(),e.willProcessNextFrame=!0,requestAnimationFrame(function(){e.setScrollTop(),e.process(),e.willProcessNextFrame=!1})},bindEvents:function(){var t=this;i.on("resize.viewport",e.proxy(t.onResize,t)),i.on("scroll.viewport",e.throttle(t.throttleTime,e.proxy(t.onScroll,t))),t.hasActiveHandlers=!0},unbindEvents:function(){i.off(".viewport"),this.hasActiveHandlers=!1},maybeUnbindEvents:function(){var e=this;e.list.length||e.unbindEvents()},add:function(e){var t=this;t.list.push(e),t.hasActiveHandlers||t.bindEvents(),t.willProcessNextFrame||(t.willProcessNextFrame=!0,requestAnimationFrame(function(){t.willProcessNextFrame=!1,t.process()}))},saveDimensions:function(){var t=this;e.each(t.list,function(e,t){t.update()}),t.windowHeight=i.height(),t.windowWidth=i.width()},onScroll:function(){var e=this;e.list.length&&(e.setScrollTop(),e.process())},onResize:function(){this.refresh()},refresh:function(){this.list.length&&this.saveDimensions()},isInViewport:function(e){var t,i=this,n=e.offset,s=e.threshold,r=s,o=i.lastScrollY;return e.isThresholdPercentage&&(s=0),(t=i.isTopInView(o,i.windowHeight,n.top,e.height,s))&&e.isThresholdPercentage&&(t=i.isTopPastPercent(o,i.windowHeight,n.top,e.height,r)),t},isTopInView:function(e,t,i,n,s){var r=e+t;return i+s>=e&&i+s<r},isTopPastPercent:function(e,t,i,n,s){return(e+t-i)/t>=s},isOutOfViewport:function(e,t){var i,n=this,s=e.offset,r=n.lastScrollY;return"bottom"===t&&(i=!n.isBottomInView(r,n.windowHeight,s.top,e.height)),i},isBottomInView:function(e,t,i,n){var s=e+t,r=i+n;return r>e&&r<=s},triggerEnter:function(t){var i=this;setTimeout(function(){t.enter.call(t.element,t)},t.delay),e.isFunction(t.leave)?t.triggered=!0:i.list.splice(e.inArray(t,i.list),1),i.maybeUnbindEvents()},triggerLeave:function(e){setTimeout(function(){e.leave.call(e.element,e)},e.delay),e.triggered=!1},setScrollTop:function(){this.lastScrollY=i.scrollTop()},process:function(){var t=this,i=e.extend([],t.list);e.each(i,function(e,i){var n=t.isInViewport(i),s=i.hasLeaveCallback&&t.isOutOfViewport(i,"bottom");return!i.triggered&&n?t.triggerEnter(i):!n&&s&&i.triggered?t.triggerLeave(i):void 0})}},s.add=function(e){return s.getInstance().add(new n(e))},s.refresh=function(){s.getInstance().refresh()},s.getInstance=function(){return t||(t=new s),t},window.FF_Viewport=s}(jQuery),function(e,t,i){"use strict";function n(e,t){e.style.WebkitTransform=t,e.style.msTransform=t,e.style.transform=t}function s(){var t=l.clientWidth,i=e.innerWidth;return t<i?i:t}function r(){var t=l.clientHeight,i=e.innerHeight;return t<i?i:t}function o(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function a(e,t){return this.el=e[0],this.$el=e,this.options=o({},this.options),o(this.options,t),this._init()}var l=e.document.documentElement,d={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"}[t.prefixed("transition")],f={transitions:t.csstransitions,support3d:t.csstransforms3d};a.prototype.options={},a.prototype._init=function(){return this.$body=i("body"),this.grid=this.el.querySelector(".ff-stream-wrapper"),this.gridItems=[].slice.call(this.grid.querySelectorAll(".ff-item:not(.ff-ad)")),this.itemsCount=this.gridItems.length,this.$wrapper=this.$el.find(".ff-slideshow"),this.slideshow=this.el.querySelector(".ff-slideshow > ul"),this.$slideshow=i(this.slideshow),this.$slideshow.data("media",!1),this._addSlideShowItems(this.gridItems),this.slideshowItems=[].slice.call(this.slideshow.children),this.current=-1,this.ctrlPrev=this.el.querySelector(".ff-nav-prev"),this.ctrlNext=this.el.querySelector(".ff-nav-next"),this.ctrlClose=this.el.querySelector(".ff-nav-close"),this._initEvents(),this},a.prototype._addSlideShowItems=function(t){var n=this;t.forEach(function(t,s){var r,o,a,l,d,f=i(t),h=i('<li><div class="ff-slide-wrapper"></div></li>'),p=h.find(".ff-slide-wrapper"),c=f.find(".picture-item__inner").children().clone(),u=f.attr("data-type"),m="",g=!1;f.attr("data-media")?(n.$slideshow.data("media",!0),a=f.attr("data-media").split(";"),r=i('<div class="ff-media-wrapper'+("image"==a[3]?"":" ff-video")+'" style="width: 100%; max-height: '+a[1]+'px;"></div>'),p.prepend(r),"image"==a[3]?(l=(d=parseInt(a[0]))>600?600/d*parseInt(a[1]):a[1],m='<span class="ff-img-holder" style="width: '+a[0]+"px; max-height: "+a[1]+"px; height: "+l+"px; background-image: url("+a[2]+');"></span>',r.addClass("ff-slide-img-loading").data("media-image",a[2])):"video/mp4"==a[3]?m='<video controls width="'+a[0]+'" height="'+a[1]+'"><source src="'+a[2]+'" type="video/mp4">Your browser does not support the video tag.</video>':(a[2]=a[2].replace("http:","").replace("https:","").replace("/v/","/embed/").replace("autoplay=1","autoplay=0&fs=1"),m='<iframe width="'+a[0]+'" height="'+a[1]+'" src="'+a[2]+'" frameborder="0" allowfullscreen webkitallowfullscreen mozallowfullscreen autoplay="1" wmode="opaque"></iframe>',a[2].indexOf("facebook.com/video/embed")+1&&r.after('<span class="ff-cta">(Click image to play video)</span>')),r.data("media",m),c.find(".ff-img-holder").remove()):c.find(".ff-img-holder").length&&c.find(".ff-img-holder").each(function(e,t){var n=i(this),s=i(this).find("img"),r=s.get(0);g?n.remove():(n.removeClass("ff-img-loading").addClass("ff-img-loaded").css({"background-image":'url("'+r.src+'")',width:parseInt(r.style.width),height:parseInt(r.style.height)}),s.remove(),g=!0)}),p.append(c.not(".ff-img-holder")),o=p.find(".ff-item-cont"),/posts/.test(u)&&(u="wordpress"),o.append(h.find("h4")),o.append(h.find(".ff-article")),o.append(h.find(".ff-content").prepend(h.find(".ff-img-holder"))),o.append(h.find(".ff-item-meta")),o.find(".ff-userpic").append(h.find(".ff-icon")),o.find(".ff-item-meta").prepend(o.find(".ff-userpic")),o.find(".ff-timestamp").before("<br>").before('<span class="ff-posted">'+e.FlowFlowOpts.posted_on+" <span>"+u+"</span></span>"),h.find(".ff-content").each(function(){var e=i(this);e.is(":empty")?e.remove():e.wrap('<div class="ff-table"/>')}),n.$slideshow.append(h.attr("data-type",f.attr("data-type")))}),n.$slideshow.data("media")&&n.$slideshow.addClass("ff-slideshow-media")},a.prototype._initEvents=function(t){var n=this;this.initItemsEvents(this.gridItems),i(this.ctrlPrev).on("click",function(){n._navigate("prev")}),i(this.ctrlNext).on("click",function(){n._navigate("next")}),i(this.ctrlClose).on("click",function(){n._closeSlideshow()}),this.$wrapper.on("click",function(e){i(e.target).closest("li, nav").length||n._closeSlideshow()}),i(e).on("resize",function(){n._resizeHandler()}),i(document).on("keydown",function(e){if(n.isSlideshowVisible)switch(e.keyCode||e.which){case 37:n._navigate("prev");break;case 39:n._navigate("next");break;case 27:n._closeSlideshow()}})},a.prototype.initItemsEvents=function(e,t){var n=this,s=i(this.grid).data("opts")&&i(this.grid).data("opts").titles;t=t||0,e.forEach(function(e,r){i(e).find(".picture-item__inner").on("click",function(e){var o=i(e.target),a=o.closest("a"),l=o.closest("h4").length;if(a.length&&!o.is("img")){if("yep"===s&&l)return;if(!l)return}e.preventDefault(),n._openSlideshow(r+t)})})},a.prototype._freezeScroll=function(e){e.preventDefault()},a.prototype.checkScrollbar=function(){this.bodyIsOverflowing=document.body.scrollHeight>document.documentElement.clientHeight,this.scrollbarWidth=this.measureScrollbar()},a.prototype.setScrollbar=function(){var e=parseInt(this.$body.css("padding-right")||0,10);this.bodyIsOverflowing&&this.$body.css("padding-right",e+this.scrollbarWidth)},a.prototype.resetScrollbar=function(){this.$body.css("padding-right","")},a.prototype.measureScrollbar=function(){var e=document.createElement("div");e.className="ff-modal-scrollbar-measure",this.$body.append(e);var t=e.offsetWidth-e.clientWidth;return this.$body[0].removeChild(e),t},a.prototype._openSlideshow=function(e){this.isSlideshowVisible=!0,this.current=e,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("ff-modal-open");var t=this;setTimeout(function(){t.$wrapper.addClass("ff-slideshow-open").scrollTop(0),t._setViewportItems();var e=i(t.currentItem),o=i(t.nextItem),a=i(t.prevItem),l=s(),d=r();t.$curr=e,e.find(".ff-media-wrapper").each(function(e,t){var n=i(this);if(n.data("media")&&"inserted"!==n.data("media")){if(n.data("media-image")){var s=new Image;s.src=n.data("media-image"),s.onload=function(){n.removeClass("ff-slide-img-loading")}}n.prepend(n.data("media")),n.data("media","inserted")}}),o.add(a).find(".ff-media-wrapper").each(function(e,t){var n=i(this),s=n.data("media");if(s&&"inserted"!==s&&!/iframe|video/.test(s)){if(n.data("media-image")){var r=new Image;r.src=n.data("media-image"),r.onload=function(){n.removeClass("ff-slide-img-loading")}}n.prepend(n.data("media")),n.data("media","inserted")}}),e.addClass("ff-current ff-show");var h=parseInt(Number(t.currentItem.offsetHeight/2*1));if(2*h>d?h=parseInt(d/2)-25:t.$slideshow.bind("mousewheel DOMMouseScroll",t._freezeScroll),n(t.currentItem,f.support3d?"translate3d("+parseInt(Number(t.currentItem.offsetWidth/2*-1))+"px, -"+h+"px, 0px)":"translate(-50%, -50%)"),t.prevItem){a.addClass("ff-show");p=Number(-1*(l/2+t.prevItem.offsetWidth/2));n(t.prevItem,f.support3d?"translate3d("+p+"px, -50%, -150px)":"translate("+p+"px, -50%)")}if(t.nextItem){o.addClass("ff-show");var p=Number(l/2+t.nextItem.offsetWidth/2);n(t.nextItem,f.support3d?"translate3d("+p+"px,-50%, -150px)":"translate("+p+"px, -50%)")}},100)},a.prototype._navigate=function(e){if(!this.isAnimating)if("next"===e&&this.current===this.itemsCount-1||"prev"===e&&0===this.current)this._closeSlideshow();else{this.isAnimating=!0,this._setViewportItems();var t,o,a,l=this,h=s(),p=r(),c=this.currentItem.offsetWidth,u=f.support3d?"translate3d(-"+Number(h/2+c/2)+"px, -50%, -150px)":"translate(-"+Number(h/2+c/2)+"px, -50%)",m=f.support3d?"translate3d("+Number(h/2+c/2)+"px, -50%, -150px)":"translate("+Number(h/2+c/2)+"px, -50%)";"next"===e?(t=f.support3d?"translate3d( -"+Number(2*h/2+c/2)+"px, -50%, -150px )":"translate(-"+Number(2*h/2+c/2)+"px, -50%)",o=f.support3d?"translate3d( "+Number(2*h/2+c/2)+"px, -50%, -150px )":"translate("+Number(2*h/2+c/2)+"px, -50%)"):(t=f.support3d?"translate3d( "+Number(2*h/2+c/2)+"px, -50%, -150px )":"translate("+Number(2*h/2+c/2)+"px)",o=f.support3d?"translate3d( -"+Number(2*h/2+c/2)+"px, -50%, -150px )":"translate(-"+Number(2*h/2+c/2)+"px, -50%)"),l.$slideshow.removeClass("ff-animatable"),("next"===e&&this.current<this.itemsCount-2||"prev"===e&&this.current>1)&&(n(a=this.slideshowItems["next"===e?this.current+2:this.current-2],o),i(a).addClass("ff-show").find(".ff-media-wrapper").each(function(e,t){var n=i(this),s=n.data("media");if(s&&"inserted"!==s&&!/iframe|video/.test(s)){if(n.data("media-image")){var r=new Image;r.src=n.data("media-image"),r.onload=function(){n.removeClass("ff-slide-img-loading")}}n.prepend(n.data("media")),n.data("media","inserted")}}));setTimeout(function(){var s;l.$slideshow.addClass("ff-animatable"),l.$curr.removeClass("ff-current");var r="next"===e?l.nextItem:l.prevItem;i(r).addClass("ff-current").find(".ff-media-wrapper").each(function(e,t){var n=i(this),s=n.data("media");if(s&&"inserted"!==s){if(n.data("media-image")){var r=new Image;r.src=n.data("media-image"),r.onload=function(){n.removeClass("ff-slide-img-loading")}}n.prepend(n.data("media")),n.data("media","inserted")}}),n(l.currentItem,"next"===e?u:m),l.nextItem&&(2*(s=parseInt(Number(l.nextItem.offsetHeight/2*1)))>p?(s=parseInt(p/2)-25,"next"===e&&l.$slideshow.off("mousewheel DOMMouseScroll",l._freezeScroll)):"next"===e&&(l.$slideshow.on("mousewheel DOMMouseScroll",l._freezeScroll),l.$wrapper.scrollTop(0)),n(l.nextItem,"next"===e?f.support3d?"translate3d("+parseInt(Number(l.nextItem.offsetWidth/2*-1))+"px, -"+s+"px, 0px)":"translate(-50%, -50%)":t)),l.prevItem&&(2*(s=parseInt(Number(l.prevItem.offsetHeight/2*1)))>p?(s=parseInt(p/2)-25,"prev"===e&&l.$slideshow.off("mousewheel DOMMouseScroll",l._freezeScroll).scrollTop(0)):"prev"===e&&(l.$slideshow.on("mousewheel DOMMouseScroll",l._freezeScroll),l.$wrapper.scrollTop(0)),n(l.prevItem,"next"===e?t:f.support3d?"translate3d("+parseInt(Number(l.prevItem.offsetWidth/2*-1))+"px, -"+s+"px, 0px)":"translate(-50%, -50%)")),a&&n(a,"next"===e?m:u);var o=function(t){if(f.transitions&&h>=800){if(-1===t.originalEvent.propertyName.indexOf("transform"))return!1;i(this).off(d,o)}l.prevItem&&"next"===e?i(l.prevItem).removeClass("ff-show"):l.nextItem&&"prev"===e&&i(l.nextItem).removeClass("ff-show"),l._resetMedia(i(l.currentItem)),"next"===e?(l.prevItem=l.currentItem,l.currentItem=l.nextItem,a&&(l.nextItem=a)):(l.nextItem=l.currentItem,l.currentItem=l.prevItem,a&&(l.prevItem=a)),l.$curr=i(l.currentItem),l.current="next"===e?l.current+1:l.current-1,l.isAnimating=!1};f.transitions&&h>=800?l.$curr.on(d,o):o()},25)}},a.prototype._closeSlideshow=function(e){this.$wrapper.removeClass("ff-slideshow-open"),this.$slideshow.removeClass("ff-animatable").unbind("mousewheel DOMMouseScroll",this._freezeScroll),this.resetScrollbar(),this.$body.removeClass("ff-modal-open");var t=this,s=function(e){if(f.transitions&&e){if("section"!==e.target.tagName.toLowerCase())return;i(this).off(d,s)}var r=i(t.currentItem);t.$curr=r,r.removeClass("ff-current"),r.removeClass("ff-show"),t._resetMedia(r),t.prevItem&&i(t.prevItem).removeClass("ff-show"),t.nextItem&&i(t.nextItem).removeClass("ff-show"),t.slideshowItems.forEach(function(e){n(e,"")}),t.isSlideshowVisible=!1};f.transitions?this.$wrapper.on(d,s):s()},a.prototype._resetMedia=function(e){var t=e.attr("data-type");if("vine"!==t&&"soundcloud"!==t){var i=e.find(".ff-video"),n=i.find("iframe, video");i.prepend(n)}},a.prototype._setViewportItems=function(){this.currentItem=null,this.prevItem=null,this.nextItem=null,this.$curr=null,this.current>0&&(this.prevItem=this.slideshowItems[this.current-1]),this.current<this.itemsCount-1&&(this.nextItem=this.slideshowItems[this.current+1]),this.currentItem=this.slideshowItems[this.current],this.$curr=i(this.currentItem)},a.prototype._resizeHandler=function(){var e=this;this._resizeTimeout&&clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(function(){e._resize(),e._resizeTimeout=null},50)},a.prototype._resize=function(){if(this.isSlideshowVisible){if(this.prevItem){e=Number(-1*(s()/2+this.prevItem.offsetWidth/2));n(this.prevItem,f.support3d?"translate3d("+e+"px, -50%, -150px)":"translate("+e+"px, -50%)")}if(this.nextItem){var e=Number(s()/2+this.nextItem.offsetWidth/2);n(this.nextItem,f.support3d?"translate3d("+e+"px, -50%, -150px)":"translate("+e+"px, -50%)")}}},e.CBPGridGallery=a}(window,window.CustomModernizr,window.jQuery),function(e){"use strict";function t(e){if(document.createEvent){var t=document.createEvent("MouseEvents");t.initEvent("click",!1,!0),e.dispatchEvent(t)}else document.createEventObject?e.fireEvent("onclick"):"function"==typeof e.onclick&&e.onclick()}var i,n,s=e("html"),r=navigator.userAgent.toLowerCase(),o=/safari|chrome/.test(r),a=/android|blackBerry|iphone|ipad|ipod|opera mini|iemobile/i.test(r),l=/msie|trident.*rv\:11\./.test(r),d=/firefox/.test(r),f=!1,h=window.FlowFlowOpts;if(l){if(/msie 8/.test(r))return;i=/msie 9/.test(r)}s.addClass("ff-browser-"+(o?/chrome/.test(r)?"chrome":"safari":l?"ie"+(i?" ff-ie9":""):d?"ff":"")),e.expr.createPseudo&&"function"==typeof e.expr.createPseudo?e.expr[":"].contains=e.expr.createPseudo(function(t){return function(i){return e(i).text().toUpperCase().indexOf(t.toUpperCase())>=0}}):jQuery.expr[":"].contains=function(e,t,i){return jQuery(e).text().toUpperCase().indexOf(i[3].toUpperCase())>=0};var p=function(e){function i(){return e(document).bind("ffimgloaded",function(e,t){var i=t.$grid.data("shuffle");i&&i.layout()}),i=function(){return p},p}function s(t,i){"grid"===i.layout&&"flat"===i.theme?x(t,i["gf-style"],i.hidemeta):t.each(function(t,i){var n=e(i),s=n.find(".ff-item-cont"),r=n.find(".ff-content .ff-img-holder");n.addClass("ff-"+(r.length?"":"no-")+"image"),s.prepend(r)}),"compact"===i.layout&&"c-style-2"===i["compact-style"]&&t.find(".picture-item__inner").each(function(){var t=e(this);t.append(t.find(".ff-item-meta"))})}function r(t){var i,n,s=e(this),r=this,o=s.parent(),a=o.is("a")?o:s,l=!0;o.is(".ff-img-holder")||(i=s.attr("height"),s.removeAttr("width").removeAttr("height"),l=i&&0!=parseInt(i),n=e('<span class="ff-img-holder ff-img-loading" style="width: 100%;max-height: none"></span>'),a.wrap(n)),r.onload=function(){l||e(document).trigger("ffimgloaded",{$grid:t}),s.closest(".ff-img-holder").removeClass("ff-img-loading").addClass("ff-img-loaded")}}function o(e){var t,i,n,s,r,o,a=h.server_time,d=a-e,f=new Date(1e3*e);for(o=S.length-1;o>=0&&(t=d/S[o])<=1;o--);switch(o<0&&(o=0),t=Math.floor(t),o){case 3:if(1==t){i=h.dates.Yesterday;break}case 4:case 5:n=f.getMonth(),s=f.getDate(),i=N[n]+" "+s;break;case 6:case 7:n=f.getMonth(),s=f.getDate(),r=f.getFullYear(),i=N[n]+" "+s+", "+r;break;default:i=l(t,a,a-d%S[o],0,o)}return i}function l(e,t,i,n,s){var r=E;return e+(r=r[s])+" "+h.dates.ago}function d(e,t,i,n,s,r){var o,l,d,f,p,c,u=e.length,m="";for(r||(r=0),s&&"randomCompare"==s.order&&(e=C(e)),o=0;o<u;o++){if(d=e[o],l=o+1,"ad"!==d.type){c=void 0!==d.source?d.source:d.permalink;var g="";if(n&&d.mod){var v="new"==d.status?" ff-moderation-new-post":"",y="approved"==d.status?"checked":"";g='<div class="ff-moderation-wrapper '+("approved"==d.status?"ff-approved":"")+v+'"><span>Approve post</span> <label for="ff-mod-'+t+'"><input id="ff-mod-'+t+'" type="checkbox" class="ff-switcher" value="yes" '+y+"/><div><span></span></div></label></div>"}m+='<div class="ff-item'+(d.media&&"image"!=d.media.type?" ff-video-preview":"")+" ff-"+d.type+'" id="ff-uid-'+t+'" post-id="'+d.id+'" data-type="'+d.type+'" data-index="'+(l+r)+'"'+(d.media?' data-media="'+d.media.width+";"+d.media.height+";"+("yep"===h.forceHTTPS?d.media.url.replace("http:","https:"):d.media.url)+";"+d.media.type+'"':"")+' data-timestamp="'+d.system_timestamp+'">'+g+'<div class="picture-item__inner"><div class="ff-item-cont">'+(d.img?'<span class="ff-img-holder ff-img-loading ff-no-margin" style="width:100%;max-height:'+d.img.height+'px;"><img src="'+("yep"===h.forceHTTPS?d.img.url.replace("http:","https:"):d.img.url)+'" style="width:'+d.img.width+"px;height:"+d.img.height+'px;" /></span>':"")+(d.header?'<h4><a rel="nofollow" href="'+c+'">'+d.header+"</a></h4>":"")+'<div class="ff-content">'+d.text+"</div>",m+='<div class="ff-item-meta"><span class="ff-userpic" style="background:url('+("yep"===h.forceHTTPS?d.userpic.replace("http:","https:"):d.userpic)+')"><i class="ff-icon"><i class="ff-icon-inner"></i></i></span><a rel="nofollow" href="'+d.userlink+'" class="ff-name '+(d.userlink?"":" ff-no-link")+'">'+d.screenname+"</a>"+(d.nickname?'<a rel="nofollow" href="'+d.userlink+'" class="ff-nickname'+(d.userlink?"":" ff-no-link")+'">'+d.nickname+"</a>":"")+'<a rel="nofollow" href="'+d.permalink+'" class="ff-timestamp">'+T(d.system_timestamp,d.timestamp)+"</a></div></div>",a&&(m+='<a class="ff-mob-link" href="'+d.permalink+'"></a>'),m+="</div></div>"}else f="yep"===d.label?'data-label="'+d.labelTxt+";"+d.labelCol+'"':"",p='style="'+(d.textCol?"color:"+d.textCol+";":"")+("js"===d.adtype?"height:"+d.height+"px":"")+'"',m+='<div class="ff-item ff-'+d.type+(d.permalink?" ff-ad-link":"")+'" id="ff-uid-'+t+'" post-id="'+d.id+'" data-type="'+d.type+'" data-adtype="'+d.adtype+'" data-index="'+l+'" '+f+'><div class="picture-item__inner" style="'+(d.cardBG?"background-color:"+d.cardBG+";":"")+'"><div class="ff-item-cont"><div class="ff-content" '+p+">"+d.text.replace(/document\.write\((.+?)\)/i,function(e,i){return"jQuery("+i+').appendTo(jQuery("#ff-uid-'+t+' .ff-content"))'})+"</div>",d.permalink&&(m+='<a class="ff-link" href="'+d.permalink+'"></a>'),m+="</div></div></div>";t++}return m}function c(t,i){clearTimeout(n),f||(t.find(".ff-item").each(y),f=!0),n=setTimeout(function(){c.finder,t.find(".ff-highlight").each(function(){e(this).replaceWith(this.childNodes)}),i&&t.shuffle("shuffle",function(t,n){var s,r;return("all"===n.group||-1!==e.inArray(n.group,t.data("groups")))&&((s=t.find(':contains("'+i+'")')).length&&s.first().find("*").filter(function(){var t=e(this);return!t.children().length||t.is("p")}).each(function(t,n){e(n).is("p")?c.finder=window.findAndReplaceDOMText(n,{find:new RegExp(i,"i"),wrap:"span",clss:"ff-highlight"}):e(n).html(function(e,t){return t.replace(new RegExp(i,"i"),function(e){return'<span class="ff-highlight">'+e+"</span>"})})}),s.length||(r=-1!==(r=e.trim(t.attr("data-type")).toLowerCase()).indexOf(i)),s.length||r)})},100)}function u(t,i){f||(t.find(".ff-item").each(y),f=!0),t.shuffle("shuffle",function(t,n){if("all"!==n.group&&-1===e.inArray(n.group,t.data("groups")))return!1;var s=e.trim(t.attr("data-type")).toLowerCase();return i?-1!==s.indexOf(i):1})}function m(t,i,n,o,l,f){var p,c,u,m,y=t.find(".shuffle__sizer"),w=t.find(".ff-item");return v(w),o&&!a&&(u=t.parent(),c=new CBPGridGallery(u),m=u.find(".ff-slideshow").attr("id",u.attr("id")+"-slideshow"),"yep"===l.hidemeta&&m.addClass("ff-hide-meta"),setTimeout(function(){document.body.appendChild(m.get(0))},0)),t.find(".ff-item:not(.ff-ad) .ff-content").readmore({maxHeight:200,speed:0,afterToggle:function(){p.layout()}}),t.shuffle({itemSelector:".ff-item",sizer:y}),p=t.data("shuffle"),i&&(i=parseInt(i),t.addClass("ff-slider").parent().css("paddingBottom","70px"),_(t,i,p,n),t.shuffle("shuffle",function(e,t){return parseInt(e.attr("data-index"))<=i}),t.data("num",w.length),t.data("visible",0)),window.requestAnimationFrame&&g(t,w),t.on("done.shuffle",function(){setTimeout(function(){p.layout(),f.find(".ff-loadmore-wrapper").css("visibility","visible")},1e3)}),f.find(".ff-loadmore-wrapper span").click(function(){var i=e(this),n=f.find(".ff-loader"),o=f.find(".ff-item").not(".ff-ad").length,a={action:"fetch_posts","stream-id":l.id,page:l["next-page"],countOfPages:l.countOfPages,hash:l.hash};i.css("opacity",0),n.insertAfter(i).show().removeClass("ff-squeezed"),e.get(FlowFlowOpts.ajaxurl,a,function(a){var f=JSON.parse(a),u=f.items,m=(u.length,d(u,e('[id^="ff-uid-"]').length+1||1,!0,h.moderation,l)),y=e(m),w=y.not(".ff-ad"),x=w.toArray();if(t.trigger("loaded_more",{items:y}),l.hash=f.hash,l["next-page"]=f.page+1,l.countOfPages=f.countOfPages,t.append(y),t.shuffle("appended",y),v(y),window.requestAnimationFrame&&g(t,y),w.each(function(){e(this).find("img").not(":first").remove()}),y.find("img").each(function(){r.apply(this,[t])}),c&&(c._addSlideShowItems(x),c.initItemsEvents(x,o),c.slideshowItems=[].slice.call(c.slideshow.children),c.itemsCount=c.itemsCount+w.length),"yep"===h.open_in_new){var _=location.hostname;y.find("a").filter(function(){return this.hostname!=_}).attr("target","_blank")}if(s(w,l),n.addClass("ff-squeezed").delay(300).hide(),setTimeout(function(){w.filter(":lt(5)").addClass("in"),w.find(".ff-content").readmore({maxHeight:200,speed:0,afterToggle:function(){p.layout()}}),setTimeout(function(){f.page+1!=f.countOfPages?i.css("opacity",1):i.remove(),p.layout()},200)},14),FlowFlowOpts.dependencies.ads&&f.ads){var I=jQuery.post(h.ajaxurl,{action:"flow_flow_ad_action",status:"view",id:f.ads});e.when(I).always(function(e){})}})}),p}function g(e,t){t.each(function(){FF_Viewport.add({element:this,threshold:130,enter:y,leave:w})})}function v(e){e.find(".picture-item__inner").addClass("picture-item__inner--transition")}function y(){e(this).addClass("in").data("viewport","in")}function w(){e(this).data("viewport","out")}function x(t,i,n){t.each(function(t,s){var r,o=e(s),a=o.find(".picture-item__inner"),l=o.find(".ff-img-holder");/[12]/.test(i)?(r=o.find(".ff-item-meta"),"yep"!==n&&(o.find(".ff-item-cont").prepend(r),l.length||"style-1"===i&&r.append(r.find(".ff-userpic")))):"style-3"===i&&(a.prepend(o.find(".ff-icon")),"yep"===n&&(r=o.find(".ff-item-meta"),o.find(".ff-item-cont").prepend(r.hide()))),o.addClass("ff-"+(l.length?"":"no-")+"image"),a.prepend(l)})}function _(t,i,n,s){function r(){var e=f.data("currentSlide")-1;e<1&&(e=c),f.data("currentSlide",e),l(e),s&&setTimeout(d,0)}function o(){var e=f.data("currentSlide")+1;e>c&&(e=1),f.data("currentSlide",e),l(e),s&&setTimeout(d,0)}function l(n){t.shuffle("shuffle",function(t,s){var r,o,a;return("all"===s.group||-1!==e.inArray(s.group,t.data("groups")))&&(r=t.attr("data-index"),o=i*(n-1),a=i*n,r>o&&r<=a)})}function d(){var i=t.offset().top;e("html, body").animate({scrollTop:i-100},300)}var f,h=e('<span class="ff-control-prev"/>'),p=e('<span class="ff-control-next"/>'),c=Math.ceil(n.$items.length/i);h.on("click",r),p.on("click",o),a&&I(t,r,o),(f=e('<div class="ff-controls-wrapper"></div>').append(h).append(p)).data("currentSlide",1),t.on("layout.shuffle",function(){}),t.append(f)}function I(e,t,i){var n,s,r,o,a;e.bind("touchstart",function(e){r=(new Date).getTime(),n=e.originalEvent.touches[0].pageX,s=e.originalEvent.touches[0].clientY}).bind("touchmove",function(e){o=e.originalEvent.touches[0].pageX,a=e.originalEvent.touches[0].clientY}).bind("touchend",function(){var e=o>n?"right":"left",l=a-s>60||-60>a-s,d=o-n>60||-60>o-n;if(!((new Date).getTime()-r>300||l)&&d)switch(e){case"left":i();break;case"right":t()}})}function b(t,i,n){var s=n.id,r=n.hash,o={};t.find(".ff-moderation-apply").click(function(t){var i=e.post(FlowFlowOpts.ajaxurl,{action:"moderation_apply_action",moderation_action:"custom_approve",stream:s,changed:o,hash:r});e.when(i).done(function(e){location.reload()})}),t.find(".ff-moderation-approve-new").click(function(t){var i=e.post(FlowFlowOpts.ajaxurl,{action:"moderation_apply_action",moderation_action:"new_posts_approve",stream:s,hash:r});e.when(i).done(function(e){location.reload()})}),t.on("change",".ff-moderation-wrapper input",function(t){var i=e(this),n=i.is(":checked"),s=i.closest(".ff-item").attr("post-id");i.closest(".ff-moderation-wrapper")[n?"addClass":"removeClass"]("ff-approved"),o[s]={approved:n}})}function C(e){for(var t,i,n=e.length;0!==n;)i=Math.floor(Math.random()*n),t=e[n-=1],e[n]=e[i],e[i]=t;return e}var T="agoStyleDate"===h.date_style?function(e,t){return o(e)}:function(e,t){return t},S=[1,60,3600,86400,604800,2630880,31570560,315705600],N=h.dates.months,E=[h.dates.s,h.dates.m,h.dates.h],k={};return{init:i,streams:k,addTransitionToItems:v,addViewportItems:g,prepareImageFor:r,adjustItems:s,shuffle:m,recalcLayout:function(e){e.$el.layout()},buildItems:d,buildStreamWith:function(i,n,o,l){var f,p,m,g,v,y,w,x,_,I="",C="grid"===n.layout?"ff-theme-"+n.theme:"";if(!n.feeds||"[]"===n.feeds)return"<p>No feeds to show. Add at least one</p>";if(!n.layout||!n.theme)return"<p>Please choose stream layout on options page</p>";"string"==typeof n.feeds&&(n.feeds=JSON.parse(n.feeds)),n.feeds,n.hash=i.hash,n["next-page"]=i.page+1,n.countOfPages=i.countOfPages;var T=i.items,S=0,N=T.length,E=e('[id^="ff-uid-"]').length+1||1;if("yep"!==n.gallery||a||(I+='<section class="ff-slideshow"><ul></ul><nav><span class="ff-nav-prev"></span><span class="icon ff-nav-next"></span><span class="ff-nav-close"></span></nav><div class="ff-nav-info-keys">'+window.FlowFlowOpts.lightbox_navigate+"</div></section>"),I+='<div class="ff-header ff-loading">',n.heading&&(I+="<h1>"+n.heading.replace(/\\/g,"")+"</h1>"),n.subheading&&(I+="<h2>"+n.subheading.replace(/\\/g,"")+"</h2>"),"yep"===n.filter){for(y="",w={},x=0,S=0;S<N;S++)w[T[S].type]=1;for(var F in w)"ad"!==F&&(x+=1,y+='<span class="ff-filter ff-type-'+F+'" data-filter="'+F+'"></span>');I+='<div class="ff-filter-holder">'+(x>1?'<span class="ff-filter ff-type-all">'+h.filter_all+"</span>"+y:"")+'<span class="ff-search"><input type="text" '+("grid"===n.layout?'placeholder="'+h.filter_search+'"':"")+"/></span></div>"}if(o&&(h.moderation=o,I+='<div class="ff-moderation-holder"><p><strong>PREMODERATION MODE IS ON</strong>. APPROVE POSTS AND HIT <strong>APPLY CHANGES</strong>.</p><span class="ff-moderation-button ff-moderation-apply">Apply changes</span><span class="ff-moderation-button ff-moderation-approve-new">Approve new posts</span></div>'),I+="</div>",v="grid"===n.layout?n[n.layout.charAt(0)+n.theme.charAt(0)+"-style"]:n["compact-style"],I+='<div class="ff-stream-wrapper '+C+" ff-"+(a?"mobile":"desktop")+" ff-"+(v||"nostyle")+" shuffle--container"+("grid"===n.layout&&"yep"===n.viewportin&&!a&&window.requestAnimationFrame?" shuffle--animatein":" shuffle--animateoff")+" ff-c-"+n.cmeta+'">',_=d(T,E,!0,o,n),I+=_,I+='<div class="shuffle__sizer"></div></div>',(f=e(I)).each(function(t){if(this.className.indexOf("ff-stream-wrapper")+1)return p=e(this),!1}),m=f.find(".ff-item"),g=m.not(".ff-ad"),p.data("opts",n).data("items",m),g.each(function(){e(this).find("img").not(":first").remove()}),f.find("p:empty, .ff-content:empty, .ff-content a:empty").remove(),f.find("img").each(function(){r.apply(this,[p])}),f.find(".ff-filter").click(function(){f.find(".ff-filter--active").removeClass("ff-filter--active");var t=e(this).addClass("ff-filter--active").attr("data-filter");u(p,t)}),f.find(".ff-search input").on("keyup",function(){var e=this.value.toLowerCase();c(p,e)}),f.on("click","a",function(){var t,i=e(this);return i.closest(".ff-share-wrapper").length?(t=e(this).attr("href"),window.open(t,"sharer","toolbar=0,status=0,width=626,height=436"),!1):(!i.is(".ff-no-link")||"nope"!==n.gallery&&!a)&&void 0}),"nope"===n.gallery||a?(p.addClass("ff-gallery-off").on("click",'.ff-item:not(".ff-ad") .picture-item__inner',function(i){var n=e(i.target),s=e(this);if(!n.closest("a").length||n.is("img"))return a?s.toggleClass("ff-taped"):t(s.find(".ff-timestamp")[0]),!1}),p.on("click",".ff-timestamp",function(e){e.stopImmediatePropagation()})):p.addClass("ff-gallery-on"),"yep"===h.open_in_new){var $=location.hostname;f.find("a").filter(function(){return this.hostname!=$}).attr("target","_blank")}s(g,n),o&&b(f,T,n),k[n.id]=p;for(var M in l)l[M]&&this[M].init(p);return f},setupGrid:function(e,t,i,n,s,r){setTimeout(function(){m(e,t,i,n,s,r)},0)},reformat:x,adjustImgHeight:function(t,i){t.find("img").each(function(){var t=e(this),n=parseInt(t.css("height")),s=parseInt(t.css("width")),r=i/s;t.css("height",Math.round(n*r)+"px")})}}}(e);window.FlowFlow=p.init()}(jQuery);